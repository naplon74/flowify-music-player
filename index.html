<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Flowify - Beta</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/custom-theme.css" />
    <link rel="stylesheet" href="css/new-features.css" />
    <script src="js/translations.js"></script>
  </head>
  <body data-theme="dark">
    <!-- Welcome/Onboarding Screen -->
    <div id="welcomeScreen" class="welcome-screen" style="display: none;">
      <div class="welcome-container">
        <div class="welcome-logo-container">
          <div class="welcome-logo">
            <i class="fas fa-music"></i>
          </div>
          <div class="welcome-logo-rings">
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
            <div class="ring ring-3"></div>
          </div>
        </div>
        
        <h1 class="welcome-title">
          <span class="welcome-text-line" data-i18n="welcome">Welcome to</span>
          <span class="welcome-text-brand">Flowify</span>
        </h1>
        <p class="welcome-subtitle" data-i18n="welcomeSubtitle">Your privacy-first music player</p>
        
        <div class="welcome-form">
          <div class="welcome-section">
            <label class="welcome-label">
              <i class="fas fa-language"></i>
              <span data-i18n="selectLanguage">Select your language</span>
            </label>
            <div class="language-selector">
              <button class="language-btn active" data-lang="en" onclick="selectLanguage('en')">
                <img src="assets/flag-gb.png" alt="GB" class="flag-icon">
                <span>English</span>
              </button>
              <button class="language-btn" data-lang="fr" onclick="selectLanguage('fr')">
                <img src="assets/flag-fr.png" alt="FR" class="flag-icon">
                <span>Français</span>
              </button>
              <button class="language-btn" data-lang="es" onclick="selectLanguage('es')">
                <img src="assets/flag-sp.png" alt="ES" class="flag-icon">
                <span>Español</span>
              </button>
              <button class="language-btn" data-lang="it" onclick="selectLanguage('it')">
                <img src="assets/flag-it.png" alt="IT" class="flag-icon">
                <span>Italiano</span>
              </button>
            </div>
          </div>
          
          <div class="welcome-section">
            <label class="welcome-label">
              <i class="fas fa-user"></i>
              <span data-i18n="enterName">What should we call you?</span>
            </label>
            <input 
              type="text" 
              id="welcomeNameInput" 
              class="welcome-input" 
              data-i18n="namePlaceholder"
              placeholder="Your name"
              maxlength="30"
              autocomplete="off"
              spellcheck="false"
              tabindex="1"
              style="pointer-events: auto !important; -webkit-app-region: no-drag !important; z-index: 99999 !important; position: relative !important;"
            />
          </div>
          
          <button class="welcome-submit-btn" onclick="completeOnboarding()">
            <span data-i18n="letsGo">Let's Go!</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          
          <div class="welcome-divider">
            <span>or</span>
          </div>
          
          <button class="welcome-import-btn" onclick="importProfileFromWelcome()">
            <i class="fas fa-file-import"></i>
            <span>Import Existing Profile</span>
          </button>
        </div>
        
        <div class="welcome-footer">
          <p>No account needed • No tracking • Just music</p>
        </div>
      </div>
    </div>

    <!-- Custom Nav Bar -->
    <nav class="custom-navbar">
      <div class="navbar-left">
        <button
          class="nav-back-btn"
          id="navBackBtn"
          onclick="goBack()"
          style="display: none"
        >
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="navbar-title" id="navbarTitle">
          <i class="fas fa-music"></i> Flowify
        </div>
      </div>
      <div class="navbar-right">
        <button
          class="navbar-icon-btn"
          onclick="openMiniPlayer()"
          title="Mini Player"
        >
          <i class="fas fa-square"></i>
        </button>
        <button
          class="navbar-icon-btn"
          onclick="showSettingsModal()"
          title="Settings"
        >
          <i class="fas fa-cog"></i>
        </button>
        <div id="windowControls" class="window-controls windows-style">
          <!-- Windows order (default HTML): Minimize, Maximize, Close -->
          <!-- macOS style uses CSS row-reverse so display becomes: Close (red), Maximize (green), Minimize (yellow) -->
          <button class="window-control-btn" onclick="minimizeWindow()" title="Minimize">
            <i class="fas fa-window-minimize"></i>
          </button>
          <button class="window-control-btn" onclick="maximizeWindow()" title="Maximize">
            <i class="far fa-window-maximize"></i>
          </button>
          <button class="window-control-btn close-btn" onclick="closeWindow()" title="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </nav>

    <div class="container">
      <aside class="sidebar">
        <div class="logo"><i class="fas fa-music"></i> Flowify - Beta</div>
        <div
          class="nav-item active"
          data-section="search"
          onclick="showSection('search')"
        >
          <span class="nav-icon"><i class="fas fa-compass"></i></span>
          <span data-i18n="navDiscover">Discover</span>
        </div>
        <div
          class="nav-item"
          data-section="playlists"
          onclick="showSection('playlists')"
        >
          <span class="nav-icon"><i class="fas fa-list"></i></span>
          <span data-i18n="navPlaylists">Playlists</span>
        </div>
        <div
          class="nav-item"
          data-section="queue"
          onclick="showSection('queue')"
        >
          <span class="nav-icon"><i class="fas fa-stream"></i></span>
          <span>Queue</span>
        </div>
        <div
          class="nav-item"
          data-section="statistics"
          onclick="showSection('statistics')"
        >
          <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
          <span>Statistics</span>
        </div>
        <div
          class="nav-item"
          data-section="customize"
          onclick="showSection('customize')"
        >
          <span class="nav-icon"><i class="fas fa-sliders-h"></i></span>
          <span data-i18n="navCustomize">Customize</span>
        </div>
        <div
          class="nav-item"
          data-section="info"
          onclick="showSection('info')"
        >
          <span class="nav-icon"><i class="fas fa-info-circle"></i></span>
          <span data-i18n="navInfo">Info</span>
        </div>
      </aside>

      <main class="main-content">
        <header class="header">
          <div class="search-bar" id="searchBar">
            <input
              id="query"
              class="search-input"
              type="text"
              placeholder="Search for songs, artists, albums..."
            />
            <button class="btn" id="searchBtn" onclick="search()">
              <i class="fas fa-search"></i>
              Search
            </button>
          </div>
          <div id="playlistControls" style="display: none">
            <button
              class="btn btn-secondary"
              onclick="showCreatePlaylistModal()"
            >
              <i class="fas fa-plus"></i>
              New Playlist
            </button>
            <button class="btn" onclick="importPlaylistM3U()">
              <i class="fas fa-file-import"></i>
              Import M3U
            </button>
          </div>
        </header>

        <section class="content-area">
          <section class="section active" id="search">
            <div id="userGreeting" class="user-greeting" style="display: none;">
              <h1 id="greetingText" class="greeting-text"></h1>
            </div>
            <div id="trendingSection" class="trending-section" style="display: none;">
              <h2 class="section-title">
                <i class="fas fa-fire"></i>
                <span data-i18n="trendingSongs">Trending Songs</span>
              </h2>
              <div id="trendingGrid" class="track-grid trending-grid"></div>
            </div>
            <div
              id="suggestions"
              class="suggestions-section"
              style="display: none"
            >
              <h2 class="section-title">Recommended for You</h2>
              <div id="suggestionsGrid" class="track-grid"></div>
            </div>
            <h2
              class="section-title"
              id="searchResultsTitle"
              style="display: none"
            >
              Search Results
            </h2>
            
            <!-- Artists Results -->
            <div id="artistsResults" style="display: none; margin-bottom: 30px;">
              <h3 class="section-subtitle">
                <i class="fas fa-user-music"></i> Artists
              </h3>
              <div class="gallery-container">
                <button class="gallery-scroll-btn gallery-scroll-left" onclick="scrollGallery('artistsGallery', -1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="artistsGallery" class="horizontal-scroll-gallery"></div>
                <button class="gallery-scroll-btn gallery-scroll-right" onclick="scrollGallery('artistsGallery', 1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            
            <!-- Albums Results -->
            <div id="albumsResults" style="display: none; margin-bottom: 30px;">
              <h3 class="section-subtitle">
                <i class="fas fa-compact-disc"></i> Albums
              </h3>
              <div class="gallery-container">
                <button class="gallery-scroll-btn gallery-scroll-left" onclick="scrollGallery('albumsGallery', -1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="albumsGallery" class="horizontal-scroll-gallery"></div>
                <button class="gallery-scroll-btn gallery-scroll-right" onclick="scrollGallery('albumsGallery', 1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            
            <!-- Songs Results -->
            <div id="songsResults" style="display: none; margin-bottom: 30px;">
              <h3 class="section-subtitle">
                <i class="fas fa-music"></i> Songs
              </h3>
              <div id="results" class="track-grid"></div>
            </div>
            
            <div id="searchEmpty" class="empty-state">
              <div class="welcome-state">
                <i
                  class="fas fa-music"
                  style="font-size: 64px; opacity: 0.5; margin-bottom: 20px"
                ></i>
                <h3>Welcome to Flowify</h3>
                <p>
                  Search for your favorite songs, artists, or albums to get
                  started
                </p>
              </div>
            </div>
          </section>

          <!-- Customize Page -->
          <section class="section" id="customize">
            <h2 class="section-title"><i class="fas fa-sliders-h"></i> <span data-i18n="customizeTitle">Customize</span></h2>
            <div class="settings-grid">
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-palette"></i> Theme Presets</h3>
                  <p>Choose from pre-made themes or create your own</p>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                  <select id="themePresetSelector" class="theme-selector" onchange="applyThemePreset(this.value)">
                    <option value="default">🌲 Default (Green Forest)</option>
                    <option value="cyberpunk">🌃 Cyberpunk Neon</option>
                    <option value="ocean">🌊 Ocean Breeze</option>
                    <option value="cherry">🌸 Cherry Blossom</option>
                    <option value="midnight">🌙 Midnight Dark</option>
                    <option value="sunset">🌅 Sunset Orange</option>
                    <option value="light">☀️ Light Mode</option>
                    <option value="custom">✨ Custom Theme</option>
                  </select>
                  <div style="display: flex; gap: 5px;">
                    <button class="btn btn-small" onclick="openCustomThemeEditor()" style="flex: 1;">
                      <i class="fas fa-edit"></i> Edit Custom
                    </button>
                    <button class="btn btn-small" onclick="importThemeFile()" style="flex: 1;">
                      <i class="fas fa-upload"></i> Import CSS
                    </button>
                  </div>
                </div>
              </div>
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-window-maximize"></i> Window Button Style</h3>
                  <p>Switch between Windows and macOS style window controls</p>
                </div>
                <select id="windowButtonStyleSelector" onchange="setWindowButtonStyle(this.value)" style="width: 180px;">
                  <option value="windows">Windows</option>
                  <option value="macos">macOS</option>
                </select>
              </div>
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-fire"></i> <span data-i18n="showTrending">Show Trending Songs</span></h3>
                  <p data-i18n="showTrendingDesc">Show or hide trending section on Discover</p>
                </div>
                <label class="switch"><input type="checkbox" id="custToggleTrending"><span class="slider"></span></label>
              </div>
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fab fa-discord"></i> <span data-i18n="enableDiscord">Enable Discord RPC</span></h3>
                  <p data-i18n="enableDiscordDesc">Show your activity on Discord</p>
                </div>
                <label class="switch"><input type="checkbox" id="custToggleDiscord"><span class="slider"></span></label>
              </div>
              
              <!-- Equalizer -->
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-sliders-h"></i> Equalizer</h3>
                  <p>Adjust audio frequencies</p>
                </div>
                <button class="btn" onclick="openEqualizer()">
                  <i class="fas fa-adjust"></i> Open Equalizer
                </button>
              </div>
              
              <!-- Sleep Timer -->
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-moon"></i> Sleep Timer</h3>
                  <p>Auto-pause music after set time</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                  <select id="sleepTimerSelect" class="theme-selector" style="flex: 1;">
                    <option value="0">Off</option>
                    <option value="15">15 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="90">1.5 hours</option>
                    <option value="120">2 hours</option>
                  </select>
                  <button class="btn" onclick="setSleepTimer()">
                    <i class="fas fa-check"></i> Set
                  </button>
                </div>
              </div>
              
              <!-- Crossfade -->
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-exchange-alt"></i> Crossfade</h3>
                  <p>Smooth transitions between songs</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                  <label class="switch"><input type="checkbox" id="crossfadeToggle"><span class="slider"></span></label>
                  <input type="range" min="1" max="10" value="3" id="crossfadeDuration" style="flex: 1;" />
                  <span id="crossfadeValue">3s</span>
                </div>
              </div>
              
              <!-- Visualizer -->
              <div class="setting-item">
                <div class="setting-info">
                  <h3><i class="fas fa-wave-square"></i> Audio Visualizer</h3>
                  <p>Show visual effects during playback</p>
                </div>
                <label class="switch"><input type="checkbox" id="visualizerToggle"><span class="slider"></span></label>
              </div>
            </div>
          </section>

          <section class="section" id="playlists">
            <h2 class="section-title">Your Playlists</h2>
            <div id="playlistsList"></div>
            <div id="playlistsEmpty" class="empty-state">
              <h3>No playlists yet</h3>
              <p>Create your first playlist to organize your music</p>
            </div>
          </section>

          <section class="section" id="album-detail" style="display: none;">
            <button class="btn btn-secondary" onclick="backFromAlbum()" style="margin-bottom: 20px;">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="album-detail-header">
              <img id="albumDetailCover" class="album-detail-cover" src="" alt="Album Cover" />
              <div class="album-detail-info">
                <h1 id="albumDetailTitle">Album Title</h1>
                <p id="albumDetailArtist" class="album-detail-artist">Artist Name</p>
                <p id="albumDetailYear" class="album-detail-meta"></p>
                <p id="albumDetailCount" class="album-detail-meta">0 tracks</p>
                <div class="album-detail-actions" style="margin-top: 20px;">
                  <button class="btn" onclick="playAlbum()">
                    <i class="fas fa-play"></i> Play Album
                  </button>
                  <button class="btn" onclick="addAlbumToQueue()">
                    <i class="fas fa-plus"></i> Add to Queue
                  </button>
                  <button class="btn" onclick="saveAlbumAsPlaylist()">
                    <i class="fas fa-save"></i> Save as Playlist
                  </button>
                </div>
              </div>
            </div>
            <div id="albumDetailTracks" class="track-list" style="margin-top: 30px;"></div>
          </section>

          <section class="section" id="playlist-detail">
            <button class="btn btn-secondary" onclick="backToPlaylists()" style="margin-bottom: 20px;">
              <i class="fas fa-arrow-left"></i> Back to Playlists
            </button>
            <div class="playlist-detail-header">
              <div class="playlist-detail-info">
                <h1 id="playlistDetailName">Playlist Name</h1>
                <p id="playlistDetailDesc">Description</p>
                <p id="playlistDetailCount">0 songs</p>
              </div>
              <div class="playlist-detail-actions">
                <button class="btn" onclick="playCurrentPlaylistView()">
                  <i class="fas fa-play"></i> Play All
                </button>
                <button class="btn" onclick="showEditPlaylistModal()">
                  <i class="fas fa-pen"></i> Edit
                </button>
                <button class="btn" onclick="downloadPlaylist()">
                  <i class="fas fa-download"></i> Download
                </button>
                <button class="btn" onclick="exportPlaylistM3U()">
                  <i class="fas fa-file-export"></i> Export
                </button>
                <button class="btn btn-secondary" onclick="deleteCurrentPlaylist()">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
            <div id="playlistDetailTracks"></div>
          </section>

          <section class="section" id="artist">
            <div class="artist-header" id="artistHeader" style="display: none">
              <img id="artistImage" class="artist-image" src="" alt="" />
              <div class="artist-info">
                <h1 id="artistName">Artist Name</h1>
                <p id="artistBio">Artist information</p>
              </div>
            </div>
            <div
              id="artistTracks"
              class="track-grid"
              style="margin-top: 30px"
            ></div>
          </section>

          <!-- Queue Section -->
          <section class="section" id="queue">
            <h2 class="section-title"><i class="fas fa-stream"></i> Up Next</h2>
            <div style="margin-bottom: 20px; display: flex; gap: 10px;">
              <button class="btn btn-secondary" onclick="clearQueue()">
                <i class="fas fa-trash"></i> Clear Queue
              </button>
              <button class="btn" onclick="saveQueueAsPlaylist()">
                <i class="fas fa-save"></i> Save as Playlist
              </button>
              <button class="btn" onclick="shuffleQueue()">
                <i class="fas fa-random"></i> Shuffle Queue
              </button>
            </div>
            <div id="queueList"></div>
          </section>

          <!-- Statistics Section -->
          <section class="section" id="statistics">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Your Listening Statistics</h2>
            
            <!-- Overview Stats -->
            <div class="stats-overview">
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-play-circle"></i></div>
                <div class="stat-details">
                  <div class="stat-label">Total Plays</div>
                  <div class="stat-number" id="statTotalPlays">0</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-details">
                  <div class="stat-label">Listening Time</div>
                  <div class="stat-number" id="statTotalTime">0h</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-music"></i></div>
                <div class="stat-details">
                  <div class="stat-label">Top Song</div>
                  <div class="stat-number" id="statTopSong">None</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-user-music"></i></div>
                <div class="stat-details">
                  <div class="stat-label">Top Artist</div>
                  <div class="stat-number" id="statTopArtist">None</div>
                </div>
              </div>
            </div>
            
            <!-- Recent Activity Chart -->
            <div class="stats-section">
              <h3><i class="fas fa-calendar-week"></i> Recent Activity (Last 7 Days)</h3>
              <div id="activityChart" class="activity-chart"></div>
            </div>
            
            <!-- Top Songs -->
            <div class="stats-section">
              <h3><i class="fas fa-trophy"></i> Top Songs</h3>
              <div id="topSongsList" class="stats-list"></div>
            </div>
            
            <!-- Top Artists -->
            <div class="stats-section">
              <h3><i class="fas fa-star"></i> Top Artists</h3>
              <div id="topArtistsList" class="stats-list"></div>
            </div>
          </section>

          <section class="section" id="info">
            <h2 class="section-title">About Flowify</h2>
            <div class="info-container">
              <div class="info-card">
                <h3><i class="fas fa-sync-alt"></i> Updates</h3>
                <div id="updateStatus" class="update-status">
                  <p>Current Version: <strong>v0.0.4</strong></p>
                  <button class="btn" onclick="checkForUpdates()">
                    <i class="fas fa-download"></i> Check for Updates
                  </button>
                  <div id="updateInfo" style="margin-top: 15px;"></div>
                </div>
              </div>

              <div class="info-card">
                <h3><i class="fas fa-list-alt"></i> Changelog</h3>
                <div class="changelog">
                  <div class="changelog-entry">
                    <div class="changelog-version">v0.0.4 - Beta</div>
                    <ul>
                      <li><i class="fas fa-language"></i> Added Spanish and Italian translations</li>
                      <li><i class="fas fa-flag"></i> Onboarding language selector updated with 🇪🇸 and 🇮🇹 flags</li>
                      <li><i class="fas fa-exchange-alt"></i> Language switcher added in Settings (dropdown only)</li>
                      <li><i class="fas fa-window-maximize"></i> Window Button Style toggle (Windows/macOS) with correct order/colors</li>
                      <li><i class="fab fa-discord"></i> Fixed duplicate Discord RPC logs by guarding connection attempts</li>
                      <li><i class="fas fa-moon"></i> Added Sleep Timer feature in Customize section</li>
                      <li><i class="fas fa-exchange-alt"></i> Added Crossfade feature
                      <li><i class="fas fa-wave-square"></i> Added Audio Visualizer toggle in Customize section</li>
                      <li><i class="fas fa-palette"></i> New Theme Presets: Ocean Breeze, Cherry Blossom, Midnight Dark, Sunset Orange</li>
                      <li><i class="fas fa-file-import"></i> Import Theme CSS file option added</li>
                      <li><i class="fas fa-info-circle"></i> Improved Info section with update</li>
                      <li><i class="fas fa-bug"></i> Various bug fixes and performance improvements</li>
                      <li><i class="fas fa-headphones-alt"></i> Added a mini player</li>
                      <li><i class="fas fa-chart-line"></i> Added a Statistics tab</li>
                      <li><i class="fas fa-file-alt"></i> Added Lyrics support</li>
                      <li><i class="fas fa-exclamation-triangle"></i> Known issues: ALBUMS AND ARTISTS ARE BROKEN. Lyrics aren't synced with the song timestamp, I aim to fix this asap</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <div class="info-card">
                <h3><i class="fas fa-terminal"></i> Debug Console</h3>
                <div class="debug-console" id="debugConsole"></div>
                <button class="btn btn-secondary" onclick="clearDebugConsole()" style="margin-top: 10px;">
                  <i class="fas fa-trash"></i> Clear Console
                </button>
              </div>
            </div>
          </section>
        </section>
      </main>
    </div>

    <!-- Settings Modal -->
    <div
      id="settingsModal"
      class="modal"
      style="display: none"
      onclick="closeSettingsModal(event)"
    >
      <div
        class="modal-content settings-modal-content"
        onclick="event.stopPropagation()"
      >
        <div class="modal-header">
          <h2><i class="fas fa-cog"></i> Settings</h2>
          <button class="modal-close" onclick="closeSettingsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="settings-container">
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-server"></i> Music API</h3>
              <p>Choose music streaming source</p>
              <p style="color: #ffa500; font-size: 0.85em; margin-top: 4px;">
                <i class="fas fa-info-circle"></i> Digger API is recommended for reliable playback
              </p>
              <p style="color: #ff6b6b; font-size: 0.85em; margin-top: 2px;">
                <i class="fas fa-exclamation-triangle"></i> YouTube Music API is experimental and may fail for some songs
              </p>
            </div>
            <select
              class="quality-select"
              id="musicAPISelect"
              onchange="changeMusicAPI(this.value)"
            >
              <option value="digger">Digger API ✓ Recommended</option>
              <option value="ytmusic">YouTube Music API (Experimental)</option>
            </select>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-volume-up"></i> Audio Quality</h3>
              <p>Select playback quality</p>
            </div>
            <select
              class="quality-select"
              id="qualitySelect"
              onchange="updateQuality(this.value)"
            >
              <option value="HIGH">High (320kbps)</option>
              <option value="LOSSLESS" selected>Lossless (FLAC)</option>
              <option value="HI_RES">Hi-Res (MQA)</option>
            </select>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-database"></i> Storage</h3>
              <p>Manage your downloaded music</p>
            </div>
            <button class="btn btn-secondary" onclick="clearDownloads()">
              <i class="fas fa-trash"></i> Clear Downloads
            </button>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-language"></i> Language</h3>
              <p>Select your preferred language</p>
            </div>
            <select class="quality-select" id="languageSelect" onchange="changeLanguage(this.value)">
              <option value="en">English</option>
              <option value="fr">Français</option>
              <option value="es">Español</option>
              <option value="it">Italiano</option>
            </select>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-user"></i> User Name</h3>
              <p>Change your display name</p>
            </div>
            <button class="btn" onclick="changeUserName()">
              <i class="fas fa-edit"></i> Change Name
            </button>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
              <p>Customize hotkeys</p>
            </div>
            <button class="btn" onclick="openShortcutsEditor()">
              <i class="fas fa-edit"></i> Edit Shortcuts
            </button>
          </div>
          <div class="setting-item" style="border: 2px solid rgba(88, 166, 255, 0.3); background: rgba(88, 166, 255, 0.05);">
            <div class="setting-info">
              <h3><i class="fas fa-file-export"></i> Profile Export/Import</h3>
              <p>Backup or restore your settings, playlists & data</p>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn" onclick="exportProfile()" style="flex: 1;">
                <i class="fas fa-download"></i> Export Profile
              </button>
              <button class="btn btn-secondary" onclick="importProfile()" style="flex: 1;">
                <i class="fas fa-upload"></i> Import Profile
              </button>
            </div>
          </div>
          <div class="setting-item" style="border: 2px solid rgba(255, 59, 48, 0.3); background: rgba(255, 59, 48, 0.05);">
            <div class="setting-info">
              <h3><i class="fas fa-redo"></i> Reset Application</h3>
              <p>Clear all data and restart (for testing)</p>
            </div>
            <button class="btn btn-danger" onclick="resetApp()">
              <i class="fas fa-exclamation-triangle"></i> Reset App
            </button>
          </div>
          <h3 style="text-align: center;">About</h3>
          <p style="text-align: center;">
            Flowify is a free music player, we focus on privacy, no account, no
            tracking, no bullshit, just music.
          </p>
          <p style="text-align: center;">Version 0.0.4 - Beta</p>
        </div>
      </div>
    </div>

    <!-- Custom Theme Editor Modal -->
    <div id="customThemeModal" class="modal" style="display: none" onclick="closeCustomThemeEditor(event)">
      <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 700px;">
        <div class="modal-header">
          <h2><i class="fas fa-paint-brush"></i> Custom Theme Editor</h2>
          <button class="modal-close" onclick="closeCustomThemeEditor()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="settings-container">
          <p style="margin-bottom: 20px; opacity: 0.8;">Customize your theme by changing the colors below. Click "Apply Theme" to preview, or "Reset" to restore defaults.</p>
          
          <div class="theme-editor-grid">
            <div class="color-input-group">
              <label><i class="fas fa-fill-drip"></i> Background Gradient Start</label>
              <input type="color" id="bgGradientStart" value="#0d3d2e">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-fill-drip"></i> Background Gradient Mid</label>
              <input type="color" id="bgGradientMid" value="#1a5943">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-fill-drip"></i> Background Gradient End</label>
              <input type="color" id="bgGradientEnd" value="#0f4d38">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-square"></i> Sidebar Background</label>
              <input type="color" id="sidebarBg" value="#0a1e14">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-square"></i> Card Background</label>
              <input type="color" id="cardBg" value="#0f281e">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-square"></i> Card Hover</label>
              <input type="color" id="cardHoverBg" value="#143223">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-font"></i> Primary Text</label>
              <input type="color" id="textPrimary" value="#e8f5e9">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-font"></i> Secondary Text</label>
              <input type="color" id="textSecondary" value="#c8ffd2">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-star"></i> Accent Color</label>
              <input type="color" id="accentGreen" value="#2d8659">
            </div>
            <div class="color-input-group">
              <label><i class="fas fa-star"></i> Accent Hover</label>
              <input type="color" id="accentGreenHover" value="#3aa66f">
            </div>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" onclick="applyCustomTheme()" style="flex: 1;">
              <i class="fas fa-check"></i> Apply Theme
            </button>
            <button class="btn btn-secondary" onclick="resetCustomTheme()" style="flex: 1;">
              <i class="fas fa-undo"></i> Reset to Default
            </button>
            <button class="btn" onclick="exportCustomTheme()">
              <i class="fas fa-download"></i> Export
            </button>
            <button class="btn" onclick="importCustomTheme()">
              <i class="fas fa-upload"></i> Import
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="player-bar">
      <div class="now-playing">
        <img
          id="currentImage"
          class="now-playing-image"
          src=""
          alt=""
          style="display: none"
        />
        <div class="now-playing-info">
          <h4 id="currentTitle">No song playing</h4>
          <p id="currentArtist">Select a song to start</p>
        </div>
        <button
          class="control-btn like-btn"
          id="currentLikeBtn"
          onclick="likeCurrentTrack()"
          title="Like"
        >
          <i class="far fa-heart" id="currentLikeIcon"></i>
        </button>
        <button
          class="control-btn"
          onclick="openLyrics()"
          title="Lyrics"
        >
          <i class="fas fa-align-left"></i>
        </button>
      </div>

      <div class="player-center">
        <div class="player-controls">
          <button
            class="control-btn"
            onclick="toggleShuffle()"
            id="shuffleControlBtn"
            title="Shuffle"
          >
            <i class="fas fa-random"></i>
          </button>
          <button
            class="control-btn"
            onclick="previousTrack()"
            title="Previous"
          >
            <i class="fas fa-step-backward"></i>
          </button>
          <button
            class="control-btn play-btn"
            id="playBtn"
            onclick="togglePlay()"
            title="Play/Pause"
          >
            <i class="fas fa-play"></i>
          </button>
          <button class="control-btn" onclick="nextTrack()" title="Next">
            <i class="fas fa-step-forward"></i>
          </button>
          <button
            class="control-btn"
            id="repeatBtn"
            onclick="toggleRepeat()"
            title="Repeat"
          >
            <i class="fas fa-redo"></i>
          </button>
        </div>

        <div class="progress-section">
          <span class="time-display" id="currentTime">0:00</span>
          <div class="progress-container" onclick="seekTo(event)">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <span class="time-display" id="totalTime">0:00</span>
        </div>
      </div>

      <div class="volume-control">
        <i class="fas fa-volume-up volume-icon"></i>
        <input
          type="range"
          id="volumeSlider"
          class="volume-slider"
          min="0"
          max="100"
          value="30"
          oninput="setVolume(this.value)"
        />
      </div>
    </div>

    <audio id="player" preload="auto" style="display: none"></audio>

    <!-- Add to Playlist Modal -->
    <div id="addToPlaylistModal" class="modal" onclick="closeAddToPlaylistModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h2><i class="fas fa-list"></i> Add to Playlist</h2>
          <button class="modal-close" onclick="closeAddToPlaylistModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="playlistSelectionList" class="playlist-selection-list"></div>
        <button class="btn" onclick="showCreatePlaylistFromAdd()" style="margin-top: 15px; width: 100%;">
          <i class="fas fa-plus"></i> Create New Playlist
        </button>
      </div>
    </div>

    <!-- Create Playlist Modal -->
    <div id="createPlaylistModal" class="modal" onclick="closeCreatePlaylistModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h2><i class="fas fa-plus-circle"></i> Create New Playlist</h2>
          <button class="modal-close" onclick="closeCreatePlaylistModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="form-group">
          <label for="playlistName">Playlist Name</label>
          <input
            type="text"
            id="playlistName"
            placeholder="Enter playlist name..."
          />
        </div>
        <div class="form-group">
          <label for="playlistDescription">Description (Optional)</label>
          <input
            type="text"
            id="playlistDescription"
            placeholder="Enter description..."
          />
        </div>
        <div class="modal-actions">
          <button
            class="btn btn-secondary"
            onclick="closeCreatePlaylistModal()"
          >
            Cancel
          </button>
          <button class="btn" onclick="createPlaylist()">Create</button>
        </div>
      </div>
    </div>

    <!-- Change Name Modal -->
    <div id="changeNameModal" class="modal" style="display: none;" onclick="closeChangeNameModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
        <div class="modal-header">
          <h2><i class="fas fa-user"></i> Change Name</h2>
          <button class="modal-close" onclick="closeChangeNameModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <label for="newUserName" style="display: block; margin-bottom: 10px; font-weight: 600;">
            Enter your new name:
          </label>
          <input
            type="text"
            id="newUserName"
            class="input-field"
            placeholder="Your name"
            maxlength="30"
            style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; box-sizing: border-box;"
          />
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeChangeNameModal()">
            Cancel
          </button>
          <button class="btn" onclick="saveNewUserName()">Save</button>
        </div>
      </div>
    </div>

    <!-- Edit Playlist Modal -->
    <div id="editPlaylistModal" class="modal" onclick="closeEditPlaylistModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h2><i class="fas fa-pen"></i> Edit Playlist</h2>
          <button class="modal-close" onclick="closeEditPlaylistModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="form-group">
          <label for="editPlaylistName">Playlist Name</label>
          <input type="text" id="editPlaylistName" placeholder="Enter playlist name..." />
        </div>
        <div class="form-group">
          <label for="editPlaylistDescription">Description (Optional)</label>
          <input type="text" id="editPlaylistDescription" placeholder="Enter description..." />
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeEditPlaylistModal()">Cancel</button>
          <button class="btn" onclick="applyEditPlaylist()">Save</button>
        </div>
      </div>
    </div>

    <!-- Equalizer Modal -->
    <div id="equalizerModal" class="modal" onclick="closeEqualizerModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 600px;">
        <div class="modal-header">
          <h2><i class="fas fa-sliders-h"></i> Equalizer</h2>
          <button class="modal-close" onclick="closeEqualizerModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 10px; font-weight: 600;">Preset:</label>
          <select id="eqPresetSelect" onchange="applyEQPreset(this.value)" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color);">
            <option value="flat">Flat (Default)</option>
            <option value="rock">Rock</option>
            <option value="pop">Pop</option>
            <option value="jazz">Jazz</option>
            <option value="classical">Classical</option>
            <option value="bass">Bass Boost</option>
            <option value="treble">Treble Boost</option>
            <option value="vocal">Vocal</option>
          </select>
        </div>
        <div id="eqSliders" style="display: flex; gap: 15px; justify-content: space-around; margin-bottom: 20px;">
          <!-- EQ sliders will be generated by JS -->
        </div>
        <div id="eqVisualizer" style="height: 100px; background: var(--input-bg); border-radius: 8px; display: flex; align-items: flex-end; gap: 2px; padding: 10px; justify-content: space-around;">
          <!-- Visualizer bars will be generated by JS -->
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="resetEqualizer()">Reset</button>
          <button class="btn" onclick="closeEqualizerModal()">Done</button>
        </div>
      </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="modal" onclick="closeShortcutsModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 600px;">
        <div class="modal-header">
          <h2><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h2>
          <button class="modal-close" onclick="closeShortcutsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="shortcutsList" style="max-height: 400px; overflow-y: auto;">
          <!-- Shortcuts list will be generated by JS -->
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="resetShortcuts()">Reset to Default</button>
          <button class="btn" onclick="closeShortcutsModal()">Done</button>
        </div>
      </div>
    </div>

    <!-- Lyrics Modal -->
    <div id="lyricsModal" class="modal" onclick="closeLyricsModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 500px;">
        <div class="modal-header">
          <h2><i class="fas fa-align-left"></i> Lyrics</h2>
          <button class="modal-close" onclick="closeLyricsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="lyricsContent" style="max-height: 400px; overflow-y: auto; padding: 20px; text-align: center; line-height: 1.8;">
          <p style="color: var(--text-tertiary);">No lyrics available</p>
        </div>
      </div>
    </div>

    <!-- Fullscreen Lyrics View -->
    <div id="fullscreenLyrics" class="fullscreen-lyrics" style="display: none;">
      <div class="fullscreen-lyrics-header">
        <div class="fullscreen-lyrics-info">
          <h2 id="fullscreenLyricsTitle">Song Title</h2>
          <p id="fullscreenLyricsArtist">Artist Name</p>
        </div>
        <button class="fullscreen-lyrics-close" onclick="closeFullscreenLyrics()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="fullscreen-lyrics-container" id="fullscreenLyricsContainer">
        <div id="fullscreenLyricsContent" class="fullscreen-lyrics-content">
          <p style="color: var(--text-tertiary);"><i class="fas fa-spinner fa-spin"></i> Loading lyrics...</p>
        </div>
      </div>
    </div>

    <!-- Visualizer Overlay -->
    <div id="visualizerOverlay" style="display: none; position: fixed; bottom: 100px; left: 0; right: 0; height: 150px; background: linear-gradient(to top, rgba(0,0,0,0.3), transparent); pointer-events: none; z-index: 50;">
      <canvas id="visualizerCanvas" style="width: 100%; height: 100%;"></canvas>
    </div>


    <script src="js/translations.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/albums.js"></script>
    <script src="js/new-features.js"></script>
    <script src="js/script.js"></script>
  </body>
</html>
